<!DOCTYPE html>
<html>
<head>
    <title>Sistema de Vendas Completo</title>
    <meta charset="UTF-8">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial; background: #f5f7fa; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; }
        header { background: white; padding: 20px; border-radius: 10px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h1 { color: #333; text-align: center; }
        .sections { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 20px; }
        .section { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h2 { color: #444; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 2px solid #4285f4; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; color: #666; font-weight: bold; }
        input, select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; }
        button { background: #4285f4; color: white; border: none; padding: 12px 20px; border-radius: 5px; cursor: pointer; font-weight: bold; width: 100%; }
        button:hover { background: #3367d6; }
        .status { padding: 10px; margin: 10px 0; border-radius: 5px; text-align: center; }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .lista { max-height: 300px; overflow-y: auto; margin-top: 10px; border: 1px solid #ddd; border-radius: 5px; padding: 10px; }
        .item { padding: 8px; border-bottom: 1px solid #eee; }
        .dashboard-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin: 15px 0; }
        .stat-card { background: #f8f9fa; padding: 15px; border-radius: 8px; text-align: center; border-left: 4px solid #4285f4; }
        .stat-value { font-size: 24px; font-weight: bold; color: #333; margin: 5px 0; }
        .stat-label { color: #666; font-size: 14px; }
        .produto-info { display: flex; justify-content: space-between; }
        .produto-codigo { color: #4285f4; font-weight: bold; }
        .produto-estoque { color: #34a853; font-weight: bold; }
        .venda-info { display: flex; justify-content: space-between; }
        .venda-cliente { color: #333; }
        .venda-valor { color: #ea4335; font-weight: bold; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üè™ SISTEMA DE VENDAS - FIREBASE</h1>
            <p style="text-align: center; color: #666; margin-top: 10px;">Cadastro de produtos, registro de vendas e dashboard em tempo real</p>
        </header>
        
        <div class="sections">
            <!-- CADASTRO DE PRODUTOS -->
            <div class="section">
                <h2>üì¶ CADASTRAR PRODUTO</h2>
                <div class="form-group">
                    <input type="text" id="codigo" placeholder="C√≥digo do produto (ex: CAM001)">
                </div>
                <div class="form-group">
                    <input type="text" id="nome" placeholder="Nome do produto">
                </div>
                <div class="form-group">
                    <input type="number" id="preco" placeholder="Pre√ßo R$" step="0.01">
                </div>
                <div class="form-group">
                    <input type="number" id="estoque" placeholder="Estoque inicial">
                </div>
                <button onclick="cadastrarProduto()">SALVAR PRODUTO</button>
                <div id="status-cadastro" class="status"></div>
                
                <h3>üìã Produtos Cadastrados</h3>
                <div class="lista" id="lista-produtos">
                    <div class="item">Nenhum produto cadastrado</div>
                </div>
            </div>
            
            <!-- REGISTRO DE VENDAS -->
            <div class="section">
                <h2>üí∞ REGISTRAR VENDA</h2>
                <div class="form-group">
                    <label>Selecione o produto:</label>
                    <select id="produtoSelect">
                        <option value="">Carregando produtos...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Quantidade:</label>
                    <input type="number" id="quantidade" value="1" min="1">
                </div>
                <div class="form-group">
                    <label>Nome do cliente:</label>
                    <input type="text" id="cliente" placeholder="Nome do cliente">
                </div>
                <button onclick="registrarVenda()">REGISTRAR VENDA</button>
                <div id="status-venda" class="status"></div>
                
                <h3>üõí √öltimas Vendas</h3>
                <div class="lista" id="lista-vendas">
                    <div class="item">Nenhuma venda registrada</div>
                </div>
            </div>
            
            <!-- DASHBOARD -->
            <div class="section">
                <h2>üìä DASHBOARD</h2>
                <div class="dashboard-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="total-produtos">0</div>
                        <div class="stat-label">Produtos</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="total-vendas">0</div>
                        <div class="stat-label">Vendas</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="faturamento">R$ 0</div>
                        <div class="stat-label">Faturamento</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="estoque-total">0</div>
                        <div class="stat-label">Em Estoque</div>
                    </div>
                </div>
                
                <h3>üèÜ Produtos Mais Vendidos</h3>
                <div class="lista" id="top-produtos">
                    <div class="item">Carregando...</div>
                </div>
                
                <div style="text-align: center; margin-top: 20px;">
                    <a href="https://deliveryapp-a6c48-default-rtdb.firebaseio.com/" target="_blank" style="color: #4285f4;">
                        üîç Ver dados no Firebase
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- FIREBASE -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    
    <script>
        // CONFIGURA√á√ÉO
        const firebaseConfig = {
            apiKey: "AIzaSyDhxzoRmrYhuIwKkFtlF_H36NklLwVXSN0",
            authDomain: "deliveryapp-a6c48.firebaseapp.com",
            databaseURL: "https://deliveryapp-a6c48-default-rtdb.firebaseio.com",
            projectId: "deliveryapp-a6c48",
            storageBucket: "deliveryapp-a6c48.firebasestorage.app",
            messagingSenderId: "547092721941",
            appId: "1:547092721941:web:b0feaefe7d6265c32bf91c"
        };

        // INICIALIZAR
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        
        console.log("‚úÖ Sistema conectado ao Firebase!");

        // ========== FUN√á√ïES ==========
        
        // CADASTRAR PRODUTO
        window.cadastrarProduto = function() {
            const codigo = document.getElementById('codigo').value.trim();
            const nome = document.getElementById('nome').value.trim();
            const preco = document.getElementById('preco').value;
            const estoque = document.getElementById('estoque').value;
            
            if (!codigo || !nome || !preco || !estoque) {
                showStatus('status-cadastro', 'Preencha todos os campos!', 'error');
                return;
            }
            
            const produtoId = Date.now().toString();
            const produtoData = {
                id: produtoId,
                codigo: codigo,
                nome: nome,
                preco: parseFloat(preco),
                estoque: parseInt(estoque),
                estoqueAtual: parseInt(estoque),
                vendas: 0,
                dataCadastro: new Date().toISOString()
            };
            
            database.ref('produtos/' + produtoId).set(produtoData)
                .then(() => {
                    showStatus('status-cadastro', '‚úÖ Produto cadastrado com sucesso!', 'success');
                    document.getElementById('codigo').value = '';
                    document.getElementById('nome').value = '';
                    document.getElementById('preco').value = '';
                    document.getElementById('estoque').value = '';
                })
                .catch(error => {
                    showStatus('status-cadastro', '‚ùå Erro: ' + error.message, 'error');
                });
        };
        
        // REGISTRAR VENDA
        window.registrarVenda = function() {
            const produtoId = document.getElementById('produtoSelect').value;
            const quantidade = parseInt(document.getElementById('quantidade').value);
            const cliente = document.getElementById('cliente').value.trim();
            
            if (!produtoId || !quantidade || !cliente) {
                showStatus('status-venda', 'Preencha todos os campos!', 'error');
                return;
            }
            
            database.ref('produtos/' + produtoId).once('value')
                .then(snapshot => {
                    const produto = snapshot.val();
                    if (!produto) throw new Error('Produto n√£o encontrado');
                    
                    if (quantidade > produto.estoqueAtual) {
                        throw new Error(`Estoque insuficiente! Dispon√≠vel: ${produto.estoqueAtual}`);
                    }
                    
                    const vendaId = Date.now().toString();
                    const valorTotal = produto.preco * quantidade;
                    
                    const vendaData = {
                        id: vendaId,
                        produtoId: produtoId,
                        produtoCodigo: produto.codigo,
                        produtoNome: produto.nome,
                        quantidade: quantidade,
                        valorUnitario: produto.preco,
                        valorTotal: valorTotal,
                        cliente: cliente,
                        dataVenda: new Date().toISOString(),
                        timestamp: Date.now()
                    };
                    
                    // Salvar venda
                    return database.ref('vendas/' + vendaId).set(vendaData)
                        .then(() => {
                            // Atualizar estoque
                            const novoEstoque = produto.estoqueAtual - quantidade;
                            const totalVendas = (produto.vendas || 0) + quantidade;
                            return database.ref('produtos/' + produtoId).update({
                                estoqueAtual: novoEstoque,
                                vendas: totalVendas
                            });
                        });
                })
                .then(() => {
                    showStatus('status-venda', '‚úÖ Venda registrada com sucesso!', 'success');
                    document.getElementById('cliente').value = '';
                    document.getElementById('quantidade').value = '1';
                })
                .catch(error => {
                    showStatus('status-venda', '‚ùå Erro: ' + error.message, 'error');
                });
        };
        
        // MOSTRAR STATUS
        function showStatus(elementId, message, type) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = 'status ' + type;
            setTimeout(() => element.textContent = '', 3000);
        }
        
        // FORMATAR MOEDA
        function formatCurrency(value) {
            return 'R$ ' + parseFloat(value).toFixed(2).replace('.', ',');
        }
        
        // ========== CARREGAR DADOS EM TEMPO REAL ==========
        
        // PRODUTOS
        database.ref('produtos').on('value', snapshot => {
            const produtos = snapshot.val() || {};
            const lista = document.getElementById('lista-produtos');
            const select = document.getElementById('produtoSelect');
            
            lista.innerHTML = '';
            select.innerHTML = '<option value="">Selecione um produto</option>';
            
            let totalProdutos = 0;
            let estoqueTotal = 0;
            
            for (let id in produtos) {
                const produto = produtos[id];
                totalProdutos++;
                estoqueTotal += produto.estoqueAtual || 0;
                
                // Lista de produtos
                const item = document.createElement('div');
                item.className = 'item';
                item.innerHTML = `
                    <div class="produto-info">
                        <span class="produto-codigo">${produto.codigo}</span>
                        <span class="produto-estoque">${produto.estoqueAtual} un</span>
                    </div>
                    <div>${produto.nome}</div>
                    <div style="color: #34a853; font-weight: bold;">${formatCurrency(produto.preco)}</div>
                `;
                lista.appendChild(item);
                
                // Select para vendas
                if (produto.estoqueAtual > 0) {
                    const option = document.createElement('option');
                    option.value = id;
                    option.textContent = `${produto.codigo} - ${produto.nome} (${produto.estoqueAtual} dispon√≠veis)`;
                    select.appendChild(option);
                }
            }
            
            document.getElementById('total-produtos').textContent = totalProdutos;
            document.getElementById('estoque-total').textContent = estoqueTotal;
            
            if (totalProdutos === 0) {
                lista.innerHTML = '<div class="item">Nenhum produto cadastrado</div>';
            }
        });
        
        // VENDAS E DASHBOARD
        database.ref('vendas').on('value', snapshot => {
            const vendas = snapshot.val() || {};
            const lista = document.getElementById('lista-vendas');
            
            lista.innerHTML = '';
            
            let totalVendas = 0;
            let faturamentoTotal = 0;
            const vendasPorProduto = {};
            
            // Converter para array e ordenar
            const vendasArray = [];
            for (let id in vendas) {
                vendasArray.push(vendas[id]);
            }
            vendasArray.sort((a, b) => b.timestamp - a.timestamp);
            
            // Processar vendas
            vendasArray.forEach((venda, index) => {
                totalVendas++;
                faturamentoTotal += venda.valorTotal || 0;
                
                // Contar por produto
                if (venda.produtoCodigo) {
                    vendasPorProduto[venda.produtoCodigo] = 
                        (vendasPorProduto[venda.produtoCodigo] || 0) + (venda.quantidade || 0);
                }
                
                // Mostrar √∫ltimas 10 vendas
                if (index < 10) {
                    const item = document.createElement('div');
                    item.className = 'item';
                    item.innerHTML = `
                        <div class="venda-info">
                            <span class="venda-cliente">${venda.cliente}</span>
                            <span class="venda-valor">${formatCurrency(venda.valorTotal)}</span>
                        </div>
                        <div>${venda.produtoNome} (${venda.quantidade}x)</div>
                        <small>${new Date(venda.dataVenda).toLocaleDateString('pt-BR')}</small>
                    `;
                    lista.appendChild(item);
                }
            });
            
            // Atualizar dashboard
            document.getElementById('total-vendas').textContent = totalVendas;
            document.getElementById('faturamento').textContent = formatCurrency(faturamentoTotal);
            
            // Top produtos
            const topDiv = document.getElementById('top-produtos');
            topDiv.innerHTML = '';
            
            const topArray = Object.entries(vendasPorProduto)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 5);
            
            topArray.forEach(([codigo, quantidade], index) => {
                const item = document.createElement('div');
                item.className = 'item';
                item.innerHTML = `
                    <strong>${index + 1}¬∫</strong> ${codigo}: 
                    <strong style="color: #ea4335;">${quantidade} vendas</strong>
                `;
                topDiv.appendChild(item);
            });
            
            if (topArray.length === 0) {
                topDiv.innerHTML = '<div class="item">Nenhuma venda registrada</div>';
            }
            
            if (totalVendas === 0) {
                lista.innerHTML = '<div class="item">Nenhuma venda registrada</div>';
            }
        });
        
        // Teste de conex√£o
        setTimeout(() => {
            showStatus('status-cadastro', '‚úÖ Sistema conectado ao Firebase!', 'success');
        }, 1000);
    </script>
</body>
</html>
